# Expense Sharing App

### Introduction

This app is for the capstone project of the udacity full stack developer course. It is designed to show the use of RESTful APIS along with RBAC security throught the third party Auth0.

The app is designed to help groups of people share expenses. If people, for example a household, are buying something for everyone they can enter the transaction into the app and the app will determine how much the buyer is owed from each person (be it for a group or for 2 individuals). It will also maintain records of the total each user is owed/owes from one another and in total across all transactions.

### Hosting locally

The app is currently live on heroku, however if you want to run the app locally you can do so by downloading all requiremnts from the requirements.txt folder and then from the command line exporting FLASK_APP=app.py and then flask run.

Note: There was a unusual error where in order for the code to run effectively locally the import addresses in the app.py file had to be .models and .auth rather than models and auth. If you are experiencing errors running the app locally please adjust this.

### Roles

The app is equipped with two roles through Auth0: administrators and users. The administrators have total permissions over all the endpoints whilst the users can use all endpoints except those that edit existing transactions. All endpoints require a Json token.

administrator_token = 'authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IlZLRUNDVUI2T2RTY0txZ2ZfRW5fQiJ9.eyJpc3MiOiJodHRwczovL2RhdmlkLWNhcHN0b25lLmV1LmF1dGgwLmNvbS8iLCJzdWIiOiJSd3k0UEpvWFZqbWFQYzQ0bWx6dzdyN3NwaWF4TktNNkBjbGllbnRzIiwiYXVkIjoiTGVuZGluZ19TZXJ2aWNlIiwiaWF0IjoxNTkxMzY0Mjc3LCJleHAiOjE1OTE0NTA2NzcsImF6cCI6IlJ3eTRQSm9YVmptYVBjNDRtbHp3N3I3c3BpYXhOS002Iiwic2NvcGUiOiJnZXQ6dHJhbnNhY3Rpb25zIGdldDp1c2VycyBnZXQ6Z3JvdXBzIHBvc3Q6dXNlcnMgcG9zdDpncm91cHMgcG9zdDp0cmFuc2FjdGlvbnMgcGF0Y2g6dHJhbnNhY3Rpb25zIGRlbGV0ZTp0cmFuc2FjdGlvbiIsImd0eSI6ImNsaWVudC1jcmVkZW50aWFscyIsInBlcm1pc3Npb25zIjpbImdldDp0cmFuc2FjdGlvbnMiLCJnZXQ6dXNlcnMiLCJnZXQ6Z3JvdXBzIiwicG9zdDp1c2VycyIsInBvc3Q6Z3JvdXBzIiwicG9zdDp0cmFuc2FjdGlvbnMiLCJwYXRjaDp0cmFuc2FjdGlvbnMiLCJkZWxldGU6dHJhbnNhY3Rpb24iXX0.VHbmxj0IrPrGFUElUdaAlNq3e4N8lvks5lFDH1ZybbniBrNOMUI1Jl7SFGkAQxXDReQLFLDYyKbeTuftPtu9V3UROJ8yOX-jndW2gifUL4lee8b1gXaOp7Fj0GnByqrL8hIBHY38lYDHn_Dch6phqy5meD4fHPSNC3FnYYKyi3w8_sIam9moOrkGYv7U7iIsw4r1qqhS5-vShNHv5NtNfK9VxaIQoy_6Y6UWECgVfUg9fu-8Wq8ROYzPMZREaxrvbnZJxuDvXl23uD_JDo1f4H2142NQLQS7uBCLeYs3qzYVD0QKtP4sT1WAqXp85YAhiVV5zxrgozLl_0TTaqy__g'

user_token = 'authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IlZLRUNDVUI2T2RTY0txZ2ZfRW5fQiJ9.eyJpc3MiOiJodHRwczovL2RhdmlkLWNhcHN0b25lLmV1LmF1dGgwLmNvbS8iLCJzdWIiOiJSd3k0UEpvWFZqbWFQYzQ0bWx6dzdyN3NwaWF4TktNNkBjbGllbnRzIiwiYXVkIjoiTGVuZGluZ19TZXJ2aWNlIiwiaWF0IjoxNTkxMzY0MjA1LCJleHAiOjE1OTE0NTA2MDUsImF6cCI6IlJ3eTRQSm9YVmptYVBjNDRtbHp3N3I3c3BpYXhOS002Iiwic2NvcGUiOiJnZXQ6dHJhbnNhY3Rpb25zIGdldDp1c2VycyBnZXQ6Z3JvdXBzIHBvc3Q6dXNlcnMgcG9zdDpncm91cHMgcG9zdDp0cmFuc2FjdGlvbnMiLCJndHkiOiJjbGllbnQtY3JlZGVudGlhbHMiLCJwZXJtaXNzaW9ucyI6WyJnZXQ6dHJhbnNhY3Rpb25zIiwiZ2V0OnVzZXJzIiwiZ2V0Omdyb3VwcyIsInBvc3Q6dXNlcnMiLCJwb3N0Omdyb3VwcyIsInBvc3Q6dHJhbnNhY3Rpb25zIl19.i8RSi3kGJT8DkWm5eb0574HvqBo2tPHqaDrpW32QikD2QVcYEe0Mn8DYp5vrsrLn2zPOSmVvRNvLkZWfCaR8WabHzUaMtBot53GFA1FYEFx7IiacM9Xe0973JpLV21-zw0sUBiQHz3g64wxfNuY_mXbWO9Cx8SEfbrNCkFtVOFimpXNPe6kk-AxPbOsnYDjFwur-5DzVK8h0xeUL-jikbfos7I15wJS_UEO2CXY05k_z2akjsNuoQ2bZdWbTnNm7Eeq93XIGQGgpngnHYlw-IlZiI1b9Th0xsKDwBn9rOfmX-mZEIAQML7ackTtU9JFrmvFOxhEqh3XwnlhKpd-IuQ'

## API Reference

The app is currently deployed to Herkou where it can be sent curl requests using the URL: https://expense-sharing-app.herokuapp.com
All requests must include a JSON token generated by Auth0, and the endpoints PATCH /transactions and DELETE /transactions must include a JSON token from the administrator role, which has the appropriate permissions. You can find the JSON tokens in the roles section.

### Error Handling

Errors are returned as JSON objects in the following format:

```
{"error":404,"message":"resource not found","success":false}
```

The API will return 3 error types when requests fail:

- 404 Recourse not found
- 422 Unprocessable
- 401 Not Authorized


### Endpoints

POST /users

- Adds a user to a database. Requires a jSON object describing the users name. Returns a JSON success message and the new user information. 

- Sample:

```
curl --request POST --header "Content-Type: application/json" --data '{"name":"Pail"}' --header '<JSON-Token>' https://expense-sharing-app.herokuapp.com/users
```

```
{"new_user":{"id":3,"name":"Pail","outstanding":{},"total_owed":0.0},"success":true}
```

POST /groups

- Adds a groups to the database. Requires a Json object with the group name and a dictionary with the primary keys of the groups members. Returns a JSON success message and the new group information.

- Sample:

```
curl --request POST --header "Content-Type: application/json" --data '{"name":"House", "users":[1,2,3]}' --header '<JSON Token>' https://expense-sharing-app.herokuapp.com/groups
```

```
{"new_group":{"id":1,"members":[{"id":1,"name":"raul"},{"id":2,"name":"Linda"},{"id":3,"name":"Pail"}],"name":"House"},"success":true}
```

GET /users

- Queries the database for all users and returns a JSON list of users along with the total amount of money they are owed and an array representing how much each individual user owes the other named "outsanding". 

- Sample:

``` 
curl --header '<JSON Token>' https://expense-sharing-app.herokuapp.com/users
 ```

```
{"success":true,"users":[{"id":2,"name":"raul","outstanding":{"1":-1.0},"total_owed":-1.0},{"id":3,"name":"Jedediah","outstanding":{"1":-1.0},"total_owed":-1.0},{"id":1,"name":"david","outstanding":{"1":-1.0,"2":1.0,"3":1.0},"total_owed":2.0}]}
```

GET /groups

- Queries the database and returns a JSON list of the groups as well as a dictionary with their members.

- Sample:

``` 
curl --header '<JSON Token> https://expense-sharing-app.herokuapp.com/groups
 ```

```
{"groups":[{"id":1,"members":[{"id":1,"name":"david"},{"id":2,"name":"raul"},{"id":3,"name":"Jedediah"}],"name":"House"}],"success":true}
```

POST /transactions

- adds a transaction to the database, also passes the information through to other functions in order to update the expense records of the user's involved in the transaction. Requires a Json object containing the item name, price, the primary key of the buyer, and the group primary key or the primary key of the 'borrower'.

``` 
curl --request POST --header "Content-Type: application/json" --data '{"item":"milk","price":3,"buyer_id":1,"group_id":1}' --header '<JSON Token>' https://expense-sharing-app.herokuapp.com/transactions
```

```
{"success":true,"transaction":{"borrower id":null,"borrower_name":"","buyer_id":1,"buyer_name":"raul","date":null,"group_id":1,"group_name":"house","id":2,"price":3.0}}
```

GET /transactions

- Queries the database and returns a JSON list of transactions.

- Sample:

```
 curl --header '<JSON Token>' https://expense-sharing-app.herokuapp.com/transactions 
```

```
{"success":true,"transactions":[{"borrower id":null,"borrower_name":"","buyer_id":1,"buyer_name":"david","date":null,"group_id":1,"group_name":"House","id":3,"price":3.0}]}
```

DELETE /transactions/<id>

- Deletes a transaction from the database and updates user records accordingly. Returns a success message and the ID of the deleted transaction.

- Sample:

```
curl --request DELETE --header '<JSON Token>' https://expense-sharing-app.herokuapp.com/transactions/1
```

PATCH /transactions/<id>

- Edits the price of an existing transaction and updates the records of the users accordingly. Requires a JSON object with the the new price. Returns a JSON success message.

- Sample:

```
curl --request PATCH --header "Content-Type: application/json" --data '{"price":6}' --header '<JSON Token>' https://expense-sharing-app.herokuapp.com/transactions/3
```  

### Testing

A unittest can be run using the test_app.py file. This test can be performed locally, to run the tests adjust the database URL in "models.py" to a empty local database and uncomment the "db_drop_and_create_all()" line in the setup_db function. then you can run the test using "python test_app.py" in the command line. 









